# XSS
`XSS` 全称是 `Cross Site Scripting(即跨站脚本)`，为了和 `CSS` 区分，故叫它`XSS`。`XSS` 攻击是指浏览器中执行恶意脚本(无论是跨域还是同域)，从而拿到用户的信息并进行操作。

如果页面被注入了恶意脚本，它都能做哪些事情？
1. 窃取 `cookie` 信息
2. 监听用户行为。如获取输入的银行卡等信息发送至黑客服务器
3. 修改DOM伪造假的登录窗口
4. 在页面内生成浮窗广告

通常情况下，实现 `XSS` 攻击的方式主要有三种

- 存储型
- 反射型
- 文档型

### 存储型
`存储型` 的XSS将脚本存在服务器，用户请求包含恶意脚本的页面，恶意脚本就会将用户的信息窃取上传的黑客服务器。

常见的场景是留言评论区提交一段脚本代码，如果前后端没有做好转义的工作，那评论内容存到了数据库，在页面渲染过程中直接执行, 相当于执行一段未知逻辑的 JS 代码，是非常恐怖的。这就是存储型的 XSS 攻击。

### 反射型
`反射型` 的XSS指的是恶意脚本作为网络请求的一部分。

比如一段URL：

    http://sanyuan.com?q=<script>alert("你被攻击了")</script>

这样，在服务端就会拿到`q`参数，然后将内容返回给浏览器，浏览器将这戏内容作为HTML的一部分解析，发现这是个脚本，直接执行，这样就被攻击了。

在现实生活中，黑客经常通过QQ群或者邮件等渠道诱导用户去点击这些恶意链接，所以对一些链接我们一定要谨慎对待。

### 文档型
`文档型`的XSS攻击并不会经过服务器，而是作为中间人，在数据传输过程中劫持网络数据包，然后修改里面的HTML文档。

这种劫持类型很多，有通过`WiFi路由器`，有通过`本地恶意软件`。

## 如何阻止XSS攻击
无论哪一种XSS攻击，它们的共同特点就是**在浏览器中注入恶意脚本**。
要防范XSS攻击，就要阻止这些脚本执行。

### 服务器对输入的脚本进行过滤或转码
我们可以在服务端对一些关键字符进行过滤

    code:<script>alert('你被攻击了')</script>
经过过滤后

    code:
除了过滤，还可以对这些内容进行转码

    code:&lt;script&gt;alert(&#39;你被攻击了&#39;)&lt;/script&gt;
经过转码之后。`<script>`标签被转为了`&lt;script&gt;`，因此即使这段脚本返回给页面，页面也不会执行这段脚本。

### 利用CSP
`CSP`，即浏览器中的内容安全策略，它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能：
1. 限制加载其他域下的资源。
2. 禁止向其他域提交数据
3. 提供上报机制，能够帮助我们及时发现XSS攻击

### 利用HttpOnly
很多XSS攻击脚本都是用来窃取Cookie，而设置Cookie的HttpOnly属性后，JavaScript便无法读取Cookie的值，这样也可以有效防范XSS攻击。


## 总结
`XSS`攻击是浏览器中执行了恶意脚本，然后拿到用户信息进行恶意操作。

主要分为`存储型`、`反射型`和`文档型`

防范措施：
- **对输入内容进行过滤或转码**
- **利用CSP**
- **利用cookie的HttpOnly属性**
